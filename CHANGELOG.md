# Changelog

Все значимые изменения в проекте будут документироваться в этом файле.

## [1.1.2]

### Добавлено

- **Интеграция с DiscordSRV** - бот теперь видит и отвечает на сообщения из Discord
  - Сообщения из Discord сохраняются в общую историю чата
  - Бот может отвечать на сообщения из Discord так же, как на внутриигровые
  - Поддержка спонтанных ответов на сообщения из Discord
  - Используется та же настройка `spontaneous-chance-message` для сообщений из Discord
- **Поиск в интернете** - бот умеет искать информацию в интернете по запросу игроков
  - Активация по ключевым словам: "найди", "поищи"
  - Работает как для внутриигрового чата, так и для сообщений из Discord
  - Ответ ограничен 500 символами (2 сообщения по 255 символов)
  - Источники не добавляются в ответ (экономия места в лимите)
  - AI адаптирует найденную информацию под лимит 500 символов

### Улучшено

- **Оптимизация использования AI провайдеров** - для простых задач (shouldAnswer) используются дешевые модели
  - Приоритет для простых задач: Gemma → Groq-Simple → Groq → Gemini → DeepSeek
  - Экономия лимитов дорогих моделей (Groq 70B) для генерации ответов
  - Fallback на обычный метод, если простой провайдер не сработал
- **Разбиение сообщений** - улучшена логика разбиения длинных сообщений
  - Добавлены отладочные логи для отслеживания разбиения
  - Проверка лимита Minecraft (256 символов) перед отправкой
  - Улучшено обрезание по последнему пробелу (не режет слова)

### Исправлено

- Исправлена обработка сообщений из Discord через DiscordSRV
- Исправлено разбиение сообщений для DiscordSRV интеграции

## [1.1.0] - 2024-12-10

### Изменено

- **Разделение настройки шанса спонтанного ответа** на отдельные настройки для разных типов событий:
  - `spontaneous-chance-message` - для обычных сообщений в чате (по умолчанию 0.05 = 5%)
  - `spontaneous-chance-join-quit` - для вход/выход/первый заход игроков (по умолчанию 0.1 = 10%)
  - `spontaneous-chance-advancement` - для ачивок (по умолчанию 0.1 = 10%)
  - `spontaneous-chance-death` - для смертей игроков (по умолчанию 0.1 = 10%)
- Старая настройка `spontaneous-chance` помечена как устаревшая, но поддерживается для обратной совместимости

### Улучшено

- Теперь можно независимо настраивать частоту реакций бота на разные типы событий
- Более гибкая настройка поведения бота в зависимости от типа события

## [1.0.0]

### Добавлено

- Перенос логики общения из Telegram бота в Minecraft плагин
- Поддержка AI провайдеров: Gemini, Groq, DeepSeek, Gemma
- Система прямого обращения к боту через триггер "Псич"
- Спонтанные ответы бота на сообщения игроков (настраиваемый шанс)
- Система запоминания истории разговоров
- Система профилей игроков с репутацией (0-100)
- Анализ отношений с игроками и адаптация стиля общения
- Автоматическое переключение между AI провайдерами при исчерпании лимитов
- Fallback на простые модели (Gemma, Groq-Simple) при недоступности основных
- Поддержка нескольких API ключей для каждого провайдера с ротацией
- Команды управления: `/psich help`, `/psich mute`, `/psich reload`, `/psich reset`
- Настройка цвета ника бота в чате
- Редактируемый системный промпт в конфиге
- Поддержка HTTP прокси для работы на российских серверах
- Режим отладки для отслеживания работы бота
- Автоматическое разбиение длинных сообщений на части (лимит 256 символов)
- Сохранение данных в JSON файлы
- **Реакция на игровые события**: смерть игроков, достижения, подключение/отключение
- **Определение первого подключения** игрока к серверу
- **Интеграция с Discord** через Webhook для отправки сообщений бота
- **Настраиваемая задержка ответа** для более естественного поведения (1-2 секунды)
- **Обработка Discord rate limiting** с автоматическими повторными попытками
- **Ограничение на количество сообщений** - максимум 2 сообщения подряд (510 символов)
- **Фильтрация достижений** - игнорирование рецептов (recipes/\*), только реальные достижения
- **Удаление префикса из Discord** - сообщения в Discord без префикса `<Псич>` или `[Псич]`
- **Настройка аватарки** для Discord вебхука

### Технические детали

- Java 21+
- Поддержка Minecraft 1.21.10+ (Purpur/Paper/Spigot)
- Асинхронная обработка всех AI запросов
- Использование OkHttp для HTTP запросов
- Gson для работы с JSON

### Известные ограничения

- Один глобальный чат (нет поддержки приватных чатов)
- Нет обработки медиа (фото, видео, аудио)
- Нет команд для просмотра досье игроков (в отличие от Telegram версии)
